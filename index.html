<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>¡Feliz Cumpleaños Aaalleee!</title>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;600&display=swap");

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:'Cambria',sans-serif;
      background:#000;color:#fff;overflow:hidden;position:relative;
      height:100vh;width:100vw;
    }

    /* canvases */
    #rainCanvas,#starCanvas{
      position:fixed;top:0;left:0;width:100%;height:100%;z-index:1;background:#000;
      will-change:opacity;
    }
    #starCanvas{opacity:0;transition:opacity 1.2s ease-in-out;}

    /* container + textos */
    #container{
      position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
      width:100vw;height:auto;z-index:10;display:flex;align-items:center;justify-content:center;
      pointer-events:none;
    }

    #text1,#text2{
      position:absolute;top:50%;left:50%;
      transform:translate(-50%,-50%) scale(1);
      font-size:clamp(50px,10vw,120px);
      font-weight:700;letter-spacing:2px;text-align:center;color:#fbfbfb;
      user-select:none;line-height:1.1;
      text-shadow:0 0 18px rgba(99,179,237,.35),0 0 36px rgba(59,130,246,.18);
      will-change:opacity,transform;
      -webkit-font-smoothing:antialiased;
      backface-visibility:hidden;
    }

    /* glow animation (light) - lightweight */
    .text-glow{animation:subtleGlow 3s ease-in-out infinite alternate}
    @keyframes subtleGlow{
      from{ text-shadow:0 0 18px rgba(99,179,237,.25),0 0 36px rgba(59,130,246,.12) }
      to  { text-shadow:0 0 22px rgba(99,179,237,.4),0 0 46px rgba(59,130,246,.2)  }
    }

    /* responsive */
    @media (max-width:768px){ #text1,#text2{ font-size:clamp(36px,12vw,80px); letter-spacing:1px } }
    @media (max-width:480px){ #text1,#text2{ font-size:clamp(28px,15vw,60px) } }

    /* hidden img (preload) */
    #birthdayVideo{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:15;
      width:min(75vw,650px);max-height:75vh;border-radius:12px;opacity:0;transition:opacity .2s}
    #loader{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:20;color:#94a3b8}
    .spinner{width:32px;height:32px;border-radius:50%;border:2px solid rgba(148,163,184,.3);border-top:2px solid #3b82f6;animation:spin 1.2s linear infinite;margin:0 auto 12px}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <canvas id="rainCanvas"></canvas>
  <canvas id="starCanvas"></canvas>

  <div id="container">
    <span id="text1"></span>
    <span id="text2"></span>
  </div>

  <div id="loader"><div class="spinner"></div><p>Preparando tu sorpresa...</p></div>
  <img id="birthdayVideo" src="videoeditoso.gif" alt="Cumpleaños" />

  <script>
    // ---------- Preload video ----------
    let isVideoLoaded = false;
    function preloadVideo(){
      const img = new Image();
      img.onload = ()=> { isVideoLoaded = true; console.log('gif cargado'); };
      img.onerror = ()=> { isVideoLoaded = true; console.warn('error preload gif, continuando'); };
      img.src = document.getElementById('birthdayVideo').src;
    }

    // ---------- CANVAS LLUVIA (configurable) ----------
    const rainCanvas = document.getElementById('rainCanvas');
    const ctx = rainCanvas.getContext('2d');
    let DPR = Math.max(1, window.devicePixelRatio || 1);

    let fontSize = 16; // menos denso -> mejor en móvil
    let columns = 0;
    let drops = [];

    const characters = ['✰','★']; // corregido
    const color = '#7b2cbf';

    function resizeCanvases(){
      DPR = Math.max(1, window.devicePixelRatio || 1);
      rainCanvas.width = Math.floor(window.innerWidth * DPR);
      rainCanvas.height = Math.floor(window.innerHeight * DPR);
      rainCanvas.style.width = window.innerWidth + 'px';
      rainCanvas.style.height = window.innerHeight + 'px';
      ctx.setTransform(DPR,0,0,DPR,0,0); // keep drawing at CSS pixels scale

      // recalcular columnas
      columns = Math.max(2, Math.floor(window.innerWidth / fontSize));
      drops = new Array(columns).fill(1).map(()=> Math.floor(Math.random()*20)); // dispersión inicial
      // estrellas
      starCanvas.width = Math.floor(window.innerWidth * DPR);
      starCanvas.height = Math.floor(window.innerHeight * DPR);
      starCanvas.style.width = window.innerWidth + 'px';
      starCanvas.style.height = window.innerHeight + 'px';
      starCtx.setTransform(DPR,0,0,DPR,0,0);
      createStars();
    }

    // draw rain (lightweight)
    function drawRain(){
      // trail effect
      ctx.fillStyle = 'rgba(0,0,0,0.06)';
      ctx.fillRect(0,0,window.innerWidth, window.innerHeight);

      ctx.fillStyle = color;
      ctx.font = `${fontSize}px monospace`;
      drops.forEach((y,i)=>{
        const ch = characters[Math.floor(Math.random()*characters.length)];
        ctx.fillText(ch, i * fontSize, y * fontSize);
        // reset
        if (y * fontSize > window.innerHeight && Math.random() > 0.975) drops[i] = 0;
        drops[i]++;
      });
    }

    // ---------- ESTRELLAS (activan después) ----------
    const starCanvas = document.getElementById('starCanvas');
    const starCtx = starCanvas.getContext('2d');
    const stars = [];
    let numStars = 80;

    function createStars(){
      stars.length = 0;
      numStars = Math.min(120, Math.floor(window.innerWidth / 12)); // adaptativo
      for(let i=0;i<numStars;i++){
        stars.push({
          x: Math.random() * window.innerWidth,
          y: Math.random() * window.innerHeight,
          size: Math.random()*2.2 + 0.4,
          brightness: Math.random()*0.8 + 0.2,
          twinkleSpeed: Math.random()*0.06 + 0.02,
          phase: Math.random() * Math.PI * 2,
          color: Math.random() > 0.75 ? '#e0f2fe' : '#fff'
        });
      }
    }

    function drawStarsFrame(){
      starCtx.clearRect(0,0,window.innerWidth, window.innerHeight);
      stars.forEach(s=>{
        s.phase += s.twinkleSpeed;
        const tw = (Math.sin(s.phase) * 0.5 + 0.5) * s.brightness;
        starCtx.globalAlpha = tw;
        starCtx.fillStyle = s.color;
        starCtx.beginPath();
        starCtx.arc(s.x, s.y, s.size, 0, Math.PI*2);
        starCtx.fill();
      });
      starCtx.globalAlpha = 1;
    }

    // ---------- TEXTOS (morph optimizado) ----------
    const elts = {
      text1: document.getElementById('text1'),
      text2: document.getElementById('text2')
    };

    const texts = [
                    '3',
                    '2',
                    '1',
                    'Feliz',
                    'Cumpleaños',
                    'Alee!!',
                    'Espero',
                    'la pases',
                    'increíble ',
                    'y sobre todo',
                    'sin dolores ',
                    'de cuerpo :"',
                    'Espero que',
                    'te pasen',
                    'muchas cosas',
                    'geniales',
                    'y que cuando',
                    'sucedan',
                    'sepas',
                    'que mereces',
                    'cada una de ellas',
                    'cada vez',
                    'más cerca',
                    'de los 25…',
                    'NoOoOo! '];
    const morphTime = 0.5;   // segundos de morph
    const cooldownTime = 0.7; // segundos entre morphs (pausa)

    let currentIndex = 0;
    let nextIndex = 1;
    let morphProgress = 0;   // tiempo en morph
    let inCooldown = true;
    let cooldown = cooldownTime;

    // Initialize texts
    function prepareInitialTexts(){
      currentIndex = 0;
      nextIndex = 1;
      elts.text1.textContent = texts[currentIndex % texts.length];
      elts.text2.textContent = texts[nextIndex % texts.length];
      elts.text1.style.opacity = '1';
      elts.text2.style.opacity = '0';
      elts.text1.style.transform = 'translate(-50%,-50%) scale(1)';
      elts.text2.style.transform = 'translate(-50%,-50%) scale(0.9)';
    }

    function easeInOut(t){
      return t < 0.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2,3)/2;
    }

    function applyMorph(fraction){
      const f = easeInOut(Math.max(0, Math.min(1, fraction)));
      // text2 enters, text1 leaves
      elts.text2.style.opacity = String(f);
      elts.text2.style.transform = `translate(-50%,-50%) scale(${0.92 + 0.08*f})`;
      elts.text1.style.opacity = String(1 - f);
      elts.text1.style.transform = `translate(-50%,-50%) scale(${1 - 0.08*f})`;
    }

    // ---------- CONTROL DE ANIMACION ----------
    let rafId = null;
    let starRaf = null;
    let lastTime = performance.now();
    let stopMainLoop = false;
    let startStarLoop = false;

    function animate(now){
      rafId = requestAnimationFrame(animate);
      const dt = (now - lastTime) / 1000;
      lastTime = now;

      // draw rain while main loop runs
      if(!stopMainLoop) drawRain();

      // morph/cooldown state machine
      if(inCooldown){
        cooldown -= dt;
        // during cooldown show stable current text
        elts.text1.style.opacity = '1';
        elts.text2.style.opacity = '0';
        elts.text1.style.transform = 'translate(-50%,-50%) scale(1)';
        elts.text2.style.transform = 'translate(-50%,-50%) scale(0.92)';
        if(cooldown <= 0){
          // start morph
          inCooldown = false;
          morphProgress = 0;
          // ensure proper text content (already set previously, but keep safe)
          elts.text1.textContent = texts[currentIndex % texts.length];
          elts.text2.textContent = texts[nextIndex % texts.length];
        }
      } else {
        // morphing
        morphProgress += dt;
        const fraction = morphProgress / morphTime;
        if(fraction < 1){
          applyMorph(fraction);
        } else {
          // morph finished: make next the current
          applyMorph(1);
          currentIndex = nextIndex;
          nextIndex = currentIndex + 1;
          // if no more next -> sequence finished
          if(currentIndex >= texts.length - 1){
            // end main sequence:
            cancelAnimationFrame(rafId);
            stopMainLoop = true;
            transitionToSpace();
            return;
          } else {
            // prepare for cooldown before next morph
            inCooldown = true;
            cooldown = cooldownTime;
            // rotate content: text1 becomes current text, text2 next
            elts.text1.textContent = texts[currentIndex % texts.length];
            elts.text2.textContent = texts[nextIndex % texts.length];
            // reset visual state for cooldown
            elts.text1.style.opacity = '1';
            elts.text2.style.opacity = '0';
            elts.text1.style.transform = 'translate(-50%,-50%) scale(1)';
            elts.text2.style.transform = 'translate(-50%,-50%) scale(0.92)';
            morphProgress = 0;
          }
        }
      }
    }

    // ---------- TRANSICION A ESTRELLAS + VIDEO ----------
    function transitionToSpace(){
      // desvanecer lluvia (canvas) y luego arrancar estrellas con requestAnimationFrame
      rainCanvas.style.transition = 'opacity 1s ease-in-out';
      rainCanvas.style.opacity = '0';
      // después de 500ms mostrar estrellas y arrancar su loop
      setTimeout(()=>{
        document.getElementById('starCanvas').style.opacity = '1';
        startStarLoop = true;
        starLoop();
      }, 500);

      // Mostrar video después de 3500ms (igual que antes)
      setTimeout(()=> showVideo(), 3500);
    }

    function starLoop(now){
      if(!startStarLoop) return;
      starRaf = requestAnimationFrame(starLoop);
      drawStarsFrame();
    }

    // ---------- Mostrar video (igual que tu función) ----------
    function showVideo(){
      const video = document.getElementById('birthdayVideo');
      const container = document.getElementById('container');
      const loader = document.getElementById('loader');

      container.style.transition = 'opacity 1.5s ease-out';
      container.style.opacity = '0';
      setTimeout(()=>{
        container.style.display = 'none';
        if(isVideoLoaded){
          video.style.display = 'block';
          setTimeout(()=> video.style.opacity = '1', 200);
        } else {
          loader.style.display = 'block';
          const checkLoad = setInterval(()=>{
            if(isVideoLoaded){
              clearInterval(checkLoad);
              loader.style.display = 'none';
              video.style.display = 'block';
              setTimeout(()=> video.style.opacity = '1',200);
            }
          },100);
        }
      },1500);
    }

    // ---------- Resize handling ----------
    window.addEventListener('resize', ()=>{
      resizeCanvases();
    });

    // ---------- Inicializacion ----------
    preloadVideo();
    resizeCanvases();
    prepareInitialTexts();
    elts.text1.classList.add('text-glow');
    // start main animation loop
    lastTime = performance.now();
    requestAnimationFrame(animate);
  </script>
</body>
</html>
